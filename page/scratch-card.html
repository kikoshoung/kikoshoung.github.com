<script type="text/javascript" src="js/component/scratch-card.js"></script>
<h1 class="mb-l">刮刮卡小封装</h1>
<p>使用 Canvas 技术实现的刮刮卡小封装。</p>
<p>A scratch card library based on canvas.</p>
<p class="mt-m"><a target="_blank" href="https://github.com/kikoshoung/radarcharts">Fork me on github</a></p>
<div class="block">
    <div>
        <div id="container-scratchcard"></div>
    </div>
    <button class="btn mt-m" id="btn-again">再刮一次</button>
</div>
<div class="block">
    <h2>使用方法</h2>
    <ol class="decorated">
        <li>在页面内引入 <a target="_blank" href="https://raw.github.com/kikoshoung/radarcharts/master/minified/radarcharts.min.js">scratchcard.min.js</a> 或 <a target="_blank" href="https://raw.github.com/kikoshoung/radarcharts/master/js/radarcharts.js">scratchcard.js</a></li>
        <li>然后，在页面内放置你的 DOM 容器，如：&lt;div id="container-scratchcard"&gt;&lt;/div&gt;</li>
        <li>最后，构造一个 ScratchCard 实例：</li>
    </ol>
    <pre>
        <code>
var resImg = ['img/face-smile.png', 'img/face-sad.png'],
    container = $('#container-scratchcard'),
    won = Math.random() > 0.5 ? true : false,
    scratchCard;

scratchCard = new ScratchCard({
    // A wrapper element for scratch card, PS: must be an original dom object
    container: container[0],

    // Image src for win or not
    imgSrc: won ? resImg[0] : resImg[1],

    // Card size, [{width}, {height}]
    size: [240, 180],

    // Valid scratch area, [{left}, {top}, {width}, {hight}]
    // Defaults to [0, 0, {cardWidth}, {cardHeight}]
    validArea: [45, 15, 150, 150],

    // Percentage of valid scratched pixels, relies on validArea
    percentage: 0.4,

    // A callback function, invoke when scratch completed
    onComplete: function(){
        if(won) alert('我去，中奖了！')
    }

    // Scratch layer's background style
    // background: 'yellow',

    // Scratch layer's placeholder
    // placeholder: '骚年来一发吧',
    // color: 'red'
});
        </code>
    </pre>
</div>

<script type="text/javascript">
    var resImg = ['img/face-smile.png', 'img/face-sad.png'],
        container = $('#container-scratchcard'),
        btnAgain = $('#btn-again'),
        isPC = ('ontouchstart' in window) ? false : true,
        events = {
            click: isPC ? 'click' : 'touchstart',
            mousemove: isPC ? 'mousemove' : 'touchmove'
        },
        scratchCard;

    function addScratchCard(){
        var won = Math.random() > 0.5 ? true : false;

        container.innerHTML = '';
        scratchCard = new ScratchCard({
            container: container[0],
            imgSrc: won ? resImg[0] : resImg[1],
            size: [240, 180],
            validArea: [45, 15, 150, 150],
            percentage: 0.4,
            onComplete: function(){
                if(won) alert('我去，中奖了！')
            }
            // background: 'yellow',
            // text: '骚年来一发吧',
            // color: 'red'
        });
    }
    btnAgain.on(events['click'], function(e){
        scratchCard.destroy();
        container.html('正在生成刮刮卡...');
        addScratchCard();
    });

    // $(document).on(events['mousemove'], function(e){
    //     e.preventDefault();
    // });

    addScratchCard();
</script>

<script type="text/javascript">
    site.codeareaHandler($('body').find('pre'));
</script>
